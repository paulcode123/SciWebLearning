{% extends "base.html" %}

{% block title %}SciWeb - Learning Dashboard{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i class="fas fa-graduation-cap icon"></i>
        SciWeb Learning Dashboard
    </h1>
    <p class="page-subtitle">Your personalized AI-powered learning journey</p>
</div>

<div class="grid grid-3" id="projectGrid">
    {% for project in projects %}
    <div class="card project-card" data-index="{{ loop.index0 }}">
        <h3 style="color: #2d5016; margin-bottom: 10px; font-size: 1.3rem;">
            <i class="fas fa-book icon" style="color: #81c784;"></i>
            {{ project.title }}
        </h3>
        <p style="color: #4a7c59; margin-bottom: 15px; line-height: 1.5;">
            {{ project.description }}
        </p>
        
        <div style="margin-bottom: 15px;">
            <span class="badge">
                <i class="fas fa-calendar icon"></i>
                Started {{ project.created_date }}
            </span>
            <span class="badge" style="background: linear-gradient(45deg, #ffb3ba, #ffdfba); color: #8b4513;">
                <i class="fas fa-comments icon"></i>
                {{ project.conversations|length }} conversations
            </span>
        </div>
        
        <a href="{{ url_for('project_dashboard', project_id=project.id) }}" class="btn">
            <i class="fas fa-arrow-right icon"></i>
            Enter Project
        </a>
    </div>
    {% endfor %}
    
    <!-- Add New Project Card -->
    <div class="card new-project-card" data-index="{{ projects|length }}" style="border: 2px dashed #b8e6b8; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 200px;">
        <i class="fas fa-plus" style="font-size: 2rem; color: #81c784; margin-bottom: 10px;"></i>
        <h3 style="color: #4a7c59; margin-bottom: 10px;">Create New Project</h3>
        <p style="color: #4a7c59; margin-bottom: 15px;">Start a new learning journey</p>
        <button class="btn" id="openNewProjectModal">
            <i class="fas fa-plus icon"></i>
            Create New Project
        </button>
    </div>
</div>

{% if not projects %}
<div class="card" style="text-align: center; margin-top: 40px;">
    <i class="fas fa-rocket" style="font-size: 3rem; color: #81c784; margin-bottom: 20px;"></i>
    <h2 style="color: #2d5016; margin-bottom: 15px;">Welcome to SciWeb!</h2>
    <p style="color: #4a7c59; margin-bottom: 20px;">
        Start your AI-powered learning journey. Create your first project to begin exploring topics with personalized conversations.
    </p>
    <button class="btn btn-secondary" id="openNewProjectModalEmpty">
        <i class="fas fa-plus icon"></i>
        Create Your First Project
    </button>
</div>
{% endif %}
<!-- New Project Modal -->
<div id="newProjectModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.35); z-index: 1000; align-items: center; justify-content: center; padding: 20px;">
    <div class="card" style="max-width: 520px; width: 100%; text-align: center; position: relative; z-index: 1001;">
        <div style="margin-bottom: 10px;">
            <i class="fas fa-seedling" style="font-size: 2rem; color: #81c784;"></i>
        </div>
        <h2 style="color: #2d5016; margin-bottom: 10px;">Create a Learning Project</h2>
        <p style="color: #4a7c59; margin-bottom: 20px;">You'll outline what you want to learn. Ready?</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="btn" id="startOutlineBtn">
                <i class="fas fa-play icon"></i>
                Start outlining
            </button>
            <button class="btn btn-secondary" id="cancelOutlineBtn">Cancel</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Staggered animation for project cards
    const cards = document.querySelectorAll('.project-card, .new-project-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(50px)';
        card.style.animation = `fadeInUp 0.6s ease-out ${0.1 * index + 0.3}s both`;
    });
    
    // Add intelligent hover effects
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            // Subtle lift effect for surrounding cards
            cards.forEach((otherCard, otherIndex) => {
                if (otherCard !== card) {
                    const distance = Math.abs(Array.from(cards).indexOf(card) - otherIndex);
                    if (distance <= 2) {
                        otherCard.style.transform = 'translateY(-2px) scale(0.98)';
                        otherCard.style.opacity = '0.7';
                    }
                }
            });
        });
        
        card.addEventListener('mouseleave', function() {
            // Reset all cards
            cards.forEach(otherCard => {
                if (otherCard !== card) {
                    otherCard.style.transform = '';
                    otherCard.style.opacity = '';
                }
            });
        });
    });
    
    // Add shimmer effect to badges on hover
    const badges = document.querySelectorAll('.badge');
    badges.forEach(badge => {
        badge.addEventListener('mouseenter', function() {
            this.style.background = 'linear-gradient(45deg, #b8e6b8, #c8f7c5, #b8e6b8)';
            this.style.backgroundSize = '200% 100%';
            this.style.animation = 'shimmer 1.5s ease-in-out infinite';
        });
        
        badge.addEventListener('mouseleave', function() {
            this.style.animation = '';
            this.style.background = 'linear-gradient(45deg, #b8e6b8, #c8f7c5)';
            this.style.backgroundSize = '100% 100%';
        });
    });
    
    // Breathing animation for the new project card
    const newProjectCard = document.querySelector('.new-project-card');
    if (newProjectCard) {
        setInterval(() => {
            newProjectCard.style.animation = 'breathe 3s ease-in-out';
            setTimeout(() => {
                newProjectCard.style.animation = '';
            }, 3000);
        }, 8000);
    }
    
    // Add pulse effect to project icons
    const icons = document.querySelectorAll('.fa-book');
    icons.forEach(icon => {
        icon.addEventListener('mouseenter', function() {
            this.style.animation = 'pulseGlow 1s ease-in-out infinite';
        });
        
        icon.addEventListener('mouseleave', function() {
            this.style.animation = '';
        });
    });

    // New Project Modal wiring
    const openButtons = [];
    const btn1 = document.getElementById('openNewProjectModal');
    const btn2 = document.getElementById('openNewProjectModalEmpty');
    if (btn1) openButtons.push(btn1);
    if (btn2) openButtons.push(btn2);
    const modal = document.getElementById('newProjectModal');
    const startBtn = document.getElementById('startOutlineBtn');
    const cancelBtn = document.getElementById('cancelOutlineBtn');

    function openModal() {
        if (!modal) return;
        modal.style.display = 'flex';
        const card = modal.querySelector('.card');
        if (card) {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            requestAnimationFrame(() => {
                card.style.transition = 'all 0.3s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            });
        }
    }

    function closeModal() {
        if (!modal) return;
        modal.style.display = 'none';
    }

    openButtons.forEach(b => b.addEventListener('click', openModal));
    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
    if (modal) modal.addEventListener('click', function(e) {
        if (e.target === modal) closeModal();
    });
    if (startBtn) {
        startBtn.addEventListener('click', function() {
            window.location.href = '/outline';
        });
    }
});
</script>
{% endblock %}

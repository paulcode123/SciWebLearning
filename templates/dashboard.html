{% extends "base.html" %}

{% block title %}SciWeb - Learning Dashboard{% endblock %}

{% block content %}
<script>window.SCIWEB_SPLASH = true;</script>
<div class="page-header">
    <h1 class="page-title" style="margin-bottom: 14px;">
        <i class="fas fa-graduation-cap icon"></i>
        SciWeb Learning Dashboard
    </h1>
    <p class="page-subtitle" style="opacity:1; animation:none;">
        Your personalized AI-powered learning journey
    </p>
</div>

<!-- Hero with social spotlight -->
<div id="heroCard" class="card" style="margin-bottom: 16px; background-image: linear-gradient(rgba(255,255,255,0.96), rgba(255,255,255,0.96)), radial-gradient(900px 360px at 10% 30%, rgba(163,196,255,0.35), transparent 60%); background-clip: padding-box, border-box;">
    <div style="display:flex; gap:24px; align-items:center; flex-wrap:wrap; justify-content:space-between;">
        <div style="flex:1; min-width:260px;">
            <h3 style="margin:0 0 8px 0; color: var(--text-primary);">Connect first. Learn faster together.</h3>
            <p style="margin:0; color: var(--text-secondary);">Jump into your feed and messages. Study with peers in real-time.</p>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <a href="{{ url_for('feed') }}" class="btn" style="opacity:1; background: linear-gradient(45deg, #1d4ed8, #3b82f6); color:#fff; box-shadow: 0 12px 28px rgba(29,78,216,0.35);">
                <i class="fas fa-stream icon"></i> Open Feed
            </a>
            <a href="{{ url_for('messages') }}" class="btn btn-secondary" style="opacity:1; background: linear-gradient(45deg, #0ea5e9, #1d4ed8); color:#fff;">
                <i class="fas fa-message icon"></i> Messages
            </a>
            <a href="#" id="openNewProjectModalHero" class="btn" style="opacity:1;">
                <i class="fas fa-plus icon"></i> New Project
            </a>
        </div>
    </div>
 </div>

<!-- Social Spotlight -->
<div class="card" style="margin-bottom: 16px;">
    <h2 style="color: var(--text-primary); margin-bottom: 12px; display:flex; align-items:center;">
        <i class="fas fa-bolt icon" style="color:#1d4ed8;"></i>
        Social Spotlight
    </h2>
    <div class="grid grid-3">
        <div class="card" style="background: linear-gradient(135deg, rgba(29,78,216,0.08), rgba(14,165,233,0.08));">
            <h4 style="color: var(--text-primary);">Study Thread: DP Practice</h4>
            <p style="color: var(--text-secondary);">Join 24 learners practicing knapsack & LCS.</p>
            <a href="{{ url_for('feed') }}" class="btn" style="padding:8px 12px; font-size:.95rem;">
                <i class="fas fa-arrow-right icon"></i> View
            </a>
        </div>
        <div class="card" style="background: linear-gradient(135deg, rgba(29,78,216,0.08), rgba(14,165,233,0.08));">
            <h4 style="color: var(--text-primary);">Cohort: AP Physics C</h4>
            <p style="color: var(--text-secondary);">Mechanics problem set review at 6pm.</p>
            <a href="{{ url_for('cohorts') }}" class="btn" style="padding:8px 12px; font-size:.95rem;">
                <i class="fas fa-arrow-right icon"></i> Join
            </a>
        </div>
        <div class="card" style="background: linear-gradient(135deg, rgba(29,78,216,0.08), rgba(14,165,233,0.08));">
            <h4 style="color: var(--text-primary);">Whiteboard: Calculus Derivations</h4>
            <p style="color: var(--text-secondary);">Live co-drawing room starting now.</p>
            <a href="{{ url_for('study_room') }}" class="btn" style="padding:8px 12px; font-size:.95rem;">
                <i class="fas fa-arrow-right icon"></i> Enter
            </a>
        </div>
    </div>
</div>

<!-- Tools & Shortcuts -->
<div class="card" id="shortcutsCard" style="margin-bottom: 16px; background-image: linear-gradient(rgba(255,255,255,0.94), rgba(255,255,255,0.94)), radial-gradient(900px 360px at 85% 20%, rgba(168,230,207,0.35), transparent 60%); background-clip: padding-box, border-box;">
    <h2 style="color: #2d5016; margin-bottom: 14px; display: flex; align-items: center;">
        <i class="fas fa-toolbox icon" style="color:#81c784;"></i>
        Tools & Shortcuts
    </h2>
    <div class="grid grid-3">
        <div style="background: linear-gradient(135deg, rgba(245,255,245,0.95), rgba(235,255,245,0.9)); border:1px solid rgba(255,255,255,0.7); border-radius: 12px; padding: 16px; display:flex; flex-direction:column; gap:8px;">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="width:36px; height:36px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; background: linear-gradient(135deg, #66bb6a, #a8e6cf); box-shadow: 0 6px 16px rgba(129,199,132,0.35);">
                    <i class="fas fa-x-ray" style="color:#2d5016;"></i>
                </span>
                <strong style="color:#2d5016;">Weasis</strong>
            </div>
            <p style="color:#4a7c59; margin:0; font-size:0.95rem;">Open your DICOM viewer.</p>
            <div style="display:flex; gap:8px; margin-top:auto;">
                <button class="btn" onclick="openWeasis()" style="padding:8px 12px; font-size:0.95rem;">
                    <i class="fas fa-play icon"></i> Open Weasis
                </button>
                <a class="btn btn-secondary" href="https://weasis.org" target="_blank" style="padding:8px 12px; font-size:0.95rem;">
                    <i class="fas fa-info-circle icon"></i> Site
                </a>
            </div>
        </div>
        <div style="background: linear-gradient(135deg, rgba(245,255,245,0.95), rgba(235,255,245,0.9)); border:1px solid rgba(255,255,255,0.7); border-radius: 12px; padding: 16px; display:flex; flex-direction:column; gap:8px;">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="width:36px; height:36px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; background: linear-gradient(135deg, #66bb6a, #a8e6cf); box-shadow: 0 6px 16px rgba(129,199,132,0.35);">
                    <i class="fab fa-dropbox" style="color:#2d5016;"></i>
                </span>
                <strong style="color:#2d5016;">Dropbox</strong>
            </div>
            <p style="color:#4a7c59; margin:0; font-size:0.95rem;">Access your Dropbox quickly.</p>
            <div style="display:flex; gap:8px; margin-top:auto; flex-wrap:wrap;">
                <a class="btn" href="https://www.dropbox.com/home" target="_blank" style="padding:8px 12px; font-size:0.95rem;">
                    <i class="fas fa-external-link-alt icon"></i> Open Web
                </a>
                <a class="btn btn-secondary" href="file:///C:/Users/Aaron/Dropbox" style="padding:8px 12px; font-size:0.95rem;">
                    <i class="fas fa-folder-open icon"></i> Open Folder
                </a>
            </div>
        </div>
        <div style="background: linear-gradient(135deg, rgba(245,255,245,0.95), rgba(235,255,245,0.9)); border:1px solid rgba(255,255,255,0.7); border-radius: 12px; padding: 16px; display:flex; flex-direction:column; gap:8px;">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="width:36px; height:36px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; background: linear-gradient(135deg, #66bb6a, #a8e6cf); box-shadow: 0 6px 16px rgba(129,199,132,0.35);">
                    <i class="fas fa-folder" style="color:#2d5016;"></i>
                </span>
                <strong style="color:#2d5016;">OneDrive</strong>
            </div>
            <p style="color:#4a7c59; margin:0; font-size:0.95rem;">Open your OneDrive documents.</p>
            <div style="display:flex; gap:8px; margin-top:auto; flex-wrap:wrap;">
                <a class="btn" href="file:///C:/Users/Aaron/OneDrive" style="padding:8px 12px; font-size:0.95rem;">
                    <i class="fas fa-folder-open icon"></i> Open Folder
                </a>
            </div>
        </div>
        <div style="background: linear-gradient(135deg, rgba(245,255,245,0.95), rgba(235,255,245,0.9)); border:1px solid rgba(255,255,255,0.7); border-radius: 12px; padding: 16px; display:flex; flex-direction:column; gap:8px;">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="width:36px; height:36px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; background: linear-gradient(135deg, #66bb6a, #a8e6cf); box-shadow: 0 6px 16px rgba(129,199,132,0.35);">
                    <i class="fas fa-file-excel" style="color:#2d5016;"></i>
                </span>
                <strong style="color:#2d5016;">Excel</strong>
            </div>
            <p style="color:#4a7c59; margin:0; font-size:0.95rem;">Launch Microsoft Excel.</p>
            <div style="display:flex; gap:8px; margin-top:auto; flex-wrap:wrap;">
                <button class="btn" onclick="openOffice('excel')" style="padding:8px 12px; font-size:0.95rem;">
                    <i class="fas fa-play icon"></i> Open Excel
                </button>
            </div>
        </div>
        <div style="background: linear-gradient(135deg, rgba(245,255,245,0.95), rgba(235,255,245,0.9)); border:1px solid rgba(255,255,255,0.7); border-radius: 12px; padding: 16px; display:flex; flex-direction:column; gap:8px;">
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="width:36px; height:36px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; background: linear-gradient(135deg, #66bb6a, #a8e6cf); box-shadow: 0 6px 16px rgba(129,199,132,0.35);">
                    <i class="fas fa-file-word" style="color:#2d5016;"></i>
                </span>
                <strong style="color:#2d5016;">Word</strong>
            </div>
            <p style="color:#4a7c59; margin:0; font-size:0.95rem;">Launch Microsoft Word.</p>
            <div style="display:flex; gap:8px; margin-top:auto; flex-wrap:wrap;">
                <button class="btn" onclick="openOffice('word')" style="padding:8px 12px; font-size:0.95rem;">
                    <i class="fas fa-play icon"></i> Open Word
                </button>
            </div>
        </div>
    </div>
</div>
<div class="grid grid-3" id="projectGrid">
    {% for project in projects %}
    <div class="card project-card" data-index="{{ loop.index0 }}" style="height:100%; display:flex; flex-direction:column;">
        <h3 style="color: #2d5016; margin-bottom: 10px; font-size: 1.3rem;">
            <i class="fas fa-book icon" style="color: #81c784;"></i>
            {{ project.title }}
        </h3>
        <p style="color: #4a7c59; margin-bottom: 15px; line-height: 1.5;">
            {{ project.description }}
        </p>
        
        <div style="margin-bottom: 15px;">
            <span class="badge">
                <i class="fas fa-calendar icon"></i>
                Started {{ project.created_date }}
            </span>
            <span class="badge" style="background: linear-gradient(45deg, #ffb3ba, #ffdfba); color: #8b4513;">
                <i class="fas fa-comments icon"></i>
                {{ project.conversations|length }} conversations
            </span>
        </div>
        
        <div style="margin-top:auto; display:flex;">
        <a href="{{ url_for('project_dashboard', project_id=project.id) }}" class="btn" style="width:100%; text-align:center;">
            <i class="fas fa-arrow-right icon"></i>
            Enter Project
        </a>
        </div>
    </div>
    {% endfor %}
    
    <!-- Add New Project Card -->
    <div class="card new-project-card" data-index="{{ projects|length }}" style="border: 2px dashed #b8e6b8; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 220px; background: linear-gradient(135deg, rgba(168,230,207,0.25), rgba(220,237,193,0.3));">
        <i class="fas fa-plus" style="font-size: 2rem; color: #81c784; margin-bottom: 10px;"></i>
        <h3 style="color: #4a7c59; margin-bottom: 10px;">Create New Project</h3>
        <p style="color: #4a7c59; margin-bottom: 15px;">Start a new learning journey</p>
        <button class="btn" id="openNewProjectModal">
            <i class="fas fa-plus icon"></i>
            Create New Project
        </button>
    </div>
</div>

{% if not projects %}
<div class="card" style="text-align: center; margin-top: 40px;">
    <i class="fas fa-rocket" style="font-size: 3rem; color: #81c784; margin-bottom: 20px;"></i>
    <h2 style="color: #2d5016; margin-bottom: 15px;">Welcome to SciWeb!</h2>
    <p style="color: #4a7c59; margin-bottom: 20px;">
        Start your AI-powered learning journey. Create your first project to begin exploring topics with personalized conversations.
    </p>
    <button class="btn btn-secondary" id="openNewProjectModalEmpty">
        <i class="fas fa-plus icon"></i>
        Create Your First Project
    </button>
</div>
{% endif %}
<!-- New Project Modal -->
<div id="newProjectModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.35); z-index: 1000; align-items: center; justify-content: center; padding: 20px;">
    <div class="card" style="max-width: 520px; width: 100%; text-align: center; position: relative; z-index: 1001;">
        <div style="margin-bottom: 10px;">
            <i class="fas fa-seedling" style="font-size: 2rem; color: #81c784;"></i>
        </div>
        <h2 style="color: #2d5016; margin-bottom: 10px;">Create a Learning Project</h2>
        <p style="color: #4a7c59; margin-bottom: 20px;">You'll outline what you want to learn. Ready?</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="btn" id="startOutlineBtn">
                <i class="fas fa-play icon"></i>
                Start outlining
            </button>
            <button class="btn btn-secondary" id="cancelOutlineBtn">Cancel</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Staggered animation for project cards
    const cards = document.querySelectorAll('.project-card, .new-project-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(50px)';
        card.style.animation = `fadeInUp 0.6s ease-out ${0.1 * index + 0.3}s both`;
    });
    
    // Add intelligent hover effects
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            // Subtle lift effect for surrounding cards
            cards.forEach((otherCard, otherIndex) => {
                if (otherCard !== card) {
                    const distance = Math.abs(Array.from(cards).indexOf(card) - otherIndex);
                    if (distance <= 2) {
                        otherCard.style.transform = 'translateY(-2px) scale(0.98)';
                        otherCard.style.opacity = '0.7';
                    }
                }
            });
        });
        
        card.addEventListener('mouseleave', function() {
            // Reset all cards
            cards.forEach(otherCard => {
                if (otherCard !== card) {
                    otherCard.style.transform = '';
                    otherCard.style.opacity = '';
                }
            });
        });
    });
    
    // Add shimmer effect to badges on hover
    const badges = document.querySelectorAll('.badge');
    badges.forEach(badge => {
        badge.addEventListener('mouseenter', function() {
            this.style.background = 'linear-gradient(45deg, #b8e6b8, #c8f7c5, #b8e6b8)';
            this.style.backgroundSize = '200% 100%';
            this.style.animation = 'shimmer 1.5s ease-in-out infinite';
        });
        
        badge.addEventListener('mouseleave', function() {
            this.style.animation = '';
            this.style.background = 'linear-gradient(45deg, #b8e6b8, #c8f7c5)';
            this.style.backgroundSize = '100% 100%';
        });
    });
    
    // Breathing animation for the new project card
    const newProjectCard = document.querySelector('.new-project-card');
    if (newProjectCard) {
        setInterval(() => {
            newProjectCard.style.animation = 'breathe 3s ease-in-out';
            setTimeout(() => {
                newProjectCard.style.animation = '';
            }, 3000);
        }, 8000);
    }
    
    // Add pulse effect to project icons
    const icons = document.querySelectorAll('.fa-book');
    icons.forEach(icon => {
        icon.addEventListener('mouseenter', function() {
            this.style.animation = 'pulseGlow 1s ease-in-out infinite';
        });
        
        icon.addEventListener('mouseleave', function() {
            this.style.animation = '';
        });
    });

    // New Project Modal wiring
    const openButtons = [];
    const btn1 = document.getElementById('openNewProjectModal');
    const btn1b = document.getElementById('openNewProjectModalHero');
    const btn2 = document.getElementById('openNewProjectModalEmpty');
    if (btn1) openButtons.push(btn1);
    if (btn1b) openButtons.push(btn1b);
    if (btn2) openButtons.push(btn2);
    const modal = document.getElementById('newProjectModal');
    const startBtn = document.getElementById('startOutlineBtn');
    const cancelBtn = document.getElementById('cancelOutlineBtn');

    function openModal() {
        if (!modal) return;
        modal.style.display = 'flex';
        const card = modal.querySelector('.card');
        if (card) {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            requestAnimationFrame(() => {
                card.style.transition = 'all 0.3s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            });
        }
    }

    function closeModal() {
        if (!modal) return;
        modal.style.display = 'none';
    }

    openButtons.forEach(b => b.addEventListener('click', openModal));
    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
    if (modal) modal.addEventListener('click', function(e) {
        if (e.target === modal) closeModal();
    });
    if (startBtn) {
        startBtn.addEventListener('click', function() {
            window.location.href = '/outline';
        });
    }
    // Weasis launcher
    window.openWeasis = function() {
        const timeout = setTimeout(() => { window.open('https://weasis.org', '_blank'); }, 1200);
        // Attempt protocol handler if registered
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = 'weasis://';
        document.body.appendChild(iframe);
        setTimeout(() => { try { document.body.removeChild(iframe); } catch(e){} clearTimeout(timeout); }, 1500);
    };
    // Office launchers via protocol fallback
    window.openOffice = function(kind) {
        const prot = kind === 'excel' ? 'excel://' : 'ms-word://';
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = prot;
        const t = setTimeout(()=>{ alert('If the app did not open, launch it from Start Menu once to register its protocol.'); }, 1500);
        document.body.appendChild(iframe);
        setTimeout(()=>{ try{ document.body.removeChild(iframe); }catch(e){} clearTimeout(t); }, 1800);
    };
});
</script>
{% endblock %}

{% extends "base.html" %}

{% block title %}Knowledge Graph - {{ project.title }}{% endblock %}

{% block content %}
<div class="back-nav">
    <a href="{{ url_for('project_dashboard', project_id=project.id) }}" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Back to Project
    </a>
</div>

<div class="page-header">
    <h1 class="page-title"><i class="fas fa-project-diagram icon"></i> Knowledge Graph</h1>
    <p class="page-subtitle">Auto-extracted concepts and relations</p>
</div>

<div class="card" style="height: 70vh;">
    <canvas id="graphCanvas" style="width:100%; height:100%;"></canvas>
    <div style="margin-top:10px; color:#4a7c59;">
        <i class="fas fa-info-circle"></i> Tip: drag nodes, scroll to zoom.
    </div>
    <div id="legend" style="margin-top:10px;"></div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/vis-network@9.1.9/dist/vis-network.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vis-network@9.1.9/dist/vis-network.min.css"/>
<script>
const nodes = {{ nodes_json | safe }};
const edges = {{ edges_json | safe }};

document.addEventListener('DOMContentLoaded', function(){
    const container = document.getElementById('graphCanvas');
    const data = {
        nodes: new vis.DataSet(nodes.map(n => ({ id: n.id, label: n.label, group: n.type || 'concept' }))),
        edges: new vis.DataSet(edges.map(e => ({ from: e.source, to: e.target, label: e.relation, arrows: 'to' })))
    };
    const options = {
        nodes: { shape: 'dot', size: 14 },
        edges: { smooth: true, font: { align: 'middle' } },
        physics: { stabilization: true },
        interaction: { hover: true },
        groups: {
            concept: { color: { background: '#a8e6cf', border: '#66bb6a' } },
            theorem: { color: { background: '#ffdfba', border: '#ffb3ba' } },
            person: { color: { background: '#e3f2fd', border: '#0277bd' } },
        }
    };
    new vis.Network(container, data, options);
});
</script>
{% endblock %}

